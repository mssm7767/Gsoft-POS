@using System.Globalization
@model GSoftPosNew.ViewModels.SaleReceiptViewModel

@{
    ViewData["Title"] = "Sale Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .sale-details-wrapper {
        background: radial-gradient(circle at top left, #e0f2fe 0, #eff6ff 35%, #f9fafb 100%);
        min-height: 100vh;
        padding: 1rem 0 1.5rem;
    }

    .sale-details-card {
        border-radius: 1.25rem;
        border: none;
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
        overflow: hidden;
    }

    .sale-details-header {
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, #0d6efd, #2563eb);
        color: #fff;
    }

        .sale-details-header h4 {
            font-weight: 600;
            letter-spacing: .04em;
            text-transform: uppercase;
        }

    .pill {
        display: inline-flex;
        align-items: center;
        gap: .35rem;
        padding: .2rem .7rem;
        border-radius: 999px;
        font-size: .78rem;
        background: rgba(15, 23, 42, 0.08);
        color: #e5e7eb;
    }

        .pill i {
            font-size: .8rem;
        }

    .info-card {
        border-radius: .9rem;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(255, 255, 255, .9);
        padding: .85rem 1rem;
        margin-bottom: .75rem;
    }

    .info-label {
        font-size: .78rem;
        text-transform: uppercase;
        letter-spacing: .06em;
        color: #6b7280;
        margin-bottom: .15rem;
    }

    .info-value {
        font-weight: 600;
        font-size: .95rem;
        color: #111827;
    }

    .totals-card {
        border-radius: 1rem;
        border: none;
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        box-shadow: 0 14px 35px rgba(15, 23, 42, 0.18);
        padding: 1rem 1.1rem;
    }

    .totals-row {
        display: flex;
        justify-content: space-between;
        font-size: .9rem;
        margin-bottom: .15rem;
        color: #374151;
    }

        .totals-row.total {
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: .35rem;
            color: #111827;
        }

    .totals-label {
        text-transform: uppercase;
        letter-spacing: .06em;
    }

    .table-card {
        border-radius: 1.1rem;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: #ffffff;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.06);
    }

    .table thead {
        background: #f3f4f6;
        text-transform: uppercase;
        font-size: .8rem;
        letter-spacing: .05em;
    }

    .table tbody tr:hover {
        background: #eff6ff;
    }

    .btn-print {
        border-radius: 999px;
        font-weight: 600;
    }

    @@media (max-width: 768px) {
        .sale-details-header h4 {
            font-size: 1.1rem;
        }
    }
</style>

<div class="sale-details-wrapper">
    <div class="container-fluid px-3 px-md-4">
        <div class="card sale-details-card">
            <!-- Header -->
            <div class="sale-details-header">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <div>
                        <h4 class="mb-1">
                            <i class="fas fa-file-invoice-dollar me-2"></i>
                            Sale Details
                        </h4>
                        <div class="small text-light text-opacity-80">
                            <i class="far fa-calendar-alt me-1"></i>
                            @Model.SaleDate.ToString("MMM dd, yyyy hh:mm tt")
                        </div>
                    </div>

                    <div class="d-flex flex-wrap gap-2">
                        <span class="pill">
                            <i class="fas fa-hashtag"></i>
                            @Model.InvoiceNumber
                        </span>
                        <span class="pill">
                            <i class="fas fa-user"></i>
                            @Model.CashierName
                        </span>
                        @if (!string.IsNullOrWhiteSpace(Model.CustomerName))
                        {
                            <span class="pill">
                                <i class="fas fa-user-tag"></i>
                                @Model.CustomerName
                            </span>
                        }
                        <a asp-action="Receipt"
                           asp-route-id="@Model.SaleId"
                           class="btn btn-light btn-sm btn-print">
                            <i class="fas fa-print me-1"></i> Print Receipt
                        </a>
                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="card-body">
                <div class="row g-3 mb-3">
                    <!-- Left info: Customer / Payment -->
                    <div class="col-md-7">
                        <div class="info-card">
                            <div class="row g-2">
                                <div class="col-sm-8">
                                    <div class="info-label">
                                        <i class="fas fa-user me-1 text-primary"></i> Customer
                                    </div>
                                    <div class="info-value">
                                        @Model.CustomerName
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(Model.CustomerPhone))
                                    {
                                        <div class="small text-muted">
                                            <i class="fas fa-phone me-1"></i>@Model.CustomerPhone
                                        </div>
                                    }
                                    @if (!string.IsNullOrWhiteSpace(Model.CustomerAddress))
                                    {
                                        <div class="small text-muted">
                                            <i class="fas fa-home me-1"></i>@Model.CustomerAddress
                                        </div>
                                    }
                                </div>
                                <div class="col-sm-4">
                                    <div class="info-label">
                                        <i class="fas fa-wallet me-1 text-success"></i> Payment
                                    </div>
                                    <div class="info-value">
                                        @Model.PaymentMethod
                                    </div>
                                    <div class="small text-muted">
                                        Paid:
                                        @Model.PaidAmount.ToString("C", new CultureInfo("ur-PK"))
                                        <br />
                                        Change:
                                        @Model.Change.ToString("C", new CultureInfo("ur-PK"))
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="row g-2">
                                <div class="col-sm-8">
                                    <div class="info-label">
                                        <i class="fas fa-store me-1 text-info"></i> Shop
                                    </div>
                                    <div class="info-value">
                                        @((ViewBag.Setting?.ShopName ?? "G-Soft POS"))
                                    </div>
                                    <div class="small text-muted">
                                        @ViewBag.Setting?.Address
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="info-label">
                                        <i class="fas fa-balance-scale me-1 text-warning"></i> Customer Balance
                                    </div>
                                    <div class="info-value">
                                        @((ViewBag.Balance ?? 0m).ToString("C", new CultureInfo("ur-PK")))
                                    </div>
                                    <div class="small text-muted">
                                        (Positive = Receivable)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right info: Totals -->
                    <div class="col-md-5">
                        <div class="totals-card">
                            <div class="totals-row">
                                <span class="totals-label">Subtotal</span>
                                <span>@Model.SubTotal.ToString("C", new CultureInfo("ur-PK"))</span>
                            </div>
                            <div class="totals-row">
                                <span class="totals-label">Tax</span>
                                <span>@Model.Tax.ToString("C", new CultureInfo("ur-PK"))</span>
                            </div>
                            <div class="totals-row">
                                <span class="totals-label">Discount</span>
                                <span>- @Model.Discount.ToString("C", new CultureInfo("ur-PK"))</span>
                            </div>

                            <hr class="my-2" />

                            <div class="totals-row total">
                                <span>Total</span>
                                <span>@Model.Total.ToString("C", new CultureInfo("ur-PK"))</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Items table -->
                <div class="table-card">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Item</th>
                                    <th>Purchase Price</th>
                                    <th class="text-end">Sale Price</th>
                                    <th class="text-end">Qty</th>
                                    <th class="text-end">Sale Total</th>
                                    <th class="text-end">Purchase Total</th>
                                    <th class="text-end">Profit</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Items != null && Model.Items.Any())
                                {
                                    foreach (var item in Model.Items)
                                    {
                                        <tr>
                                            <td>@item.SrNo</td>
                                            <td>@item.ItemName</td>
                                            <td>@item.PurchasePrice.ToString("C", new CultureInfo("ur-PK"))</td>
                                            <td class="text-end">
                                                @item.UnitPrice.ToString("C", new CultureInfo("ur-PK"))
                                            </td>
                                            <td class="text-end">@item.Quantity</td>
                                            <td class="text-end">
                                                @item.LineTotal.ToString("C", new CultureInfo("ur-PK"))
                                            </td>
                                            <td class="text-end">
                                                @($"₨{((item.PurchasePrice) * (item.Quantity)):N2}")
                                            </td>
                                            <td class="text-end">
                                                @($"₨{((item.LineTotal) - (item.PurchasePrice * item.Quantity)):N2}")
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-3">
                                            No items found for this sale.
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Back button -->
                <div class="mt-3 d-flex justify-content-between">
                    <a asp-action="Index" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Back to Sales List
                    </a>
                    <a asp-action="Receipt"
                       asp-route-id="@Model.SaleId"
                       class="btn btn-primary btn-sm btn-print">
                        <i class="fas fa-print me-1"></i> Print Receipt
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

