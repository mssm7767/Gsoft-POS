@model GSoftPosNew.ViewModels.PosTableViewModel

@{
    ViewData["Title"] = "Add Tables";
}

@section Styles {
    <style>
        .tables-page {
            min-height: calc(100vh - 60px);
            background: radial-gradient(circle at top left, #e0f2fe, #f9fafb);
            padding: 22px 14px 40px;
        }

        .tables-shell {
            max-width: 1180px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
            gap: 18px;
        }

        .tables-card {
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.14);
            padding: 20px 22px 18px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .tables-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 8px;
            margin-bottom: 4px;
        }

        .tables-title-main {
            font-size: 1.4rem;
            font-weight: 800;
            color: #0f3f8c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .tables-title-main i {
                color: #2563eb;
            }

        .tables-badge {
            font-size: 0.78rem;
            padding: 3px 9px;
            border-radius: 999px;
            background: #e0f2fe;
            color: #1d4ed8;
            font-weight: 600;
        }

        .tables-sub {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: -4px;
        }

        .tables-form-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px 16px;
        }

        .tables-field {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

            .tables-field label {
                font-size: 0.88rem;
                font-weight: 700;
                color: #0f3f8c;
            }

            .tables-field input,
            .tables-field select,
            .tables-field textarea {
                width: 100%;
                border-radius: 10px;
                border: 1px solid #cbd5f5;
                padding: 7px 10px;
                font-size: 0.95rem;
                color: #0f172a;
                background: #f8fafc;
            }

            .tables-field small {
                font-size: 0.78rem;
                color: #94a3b8;
            }

        .tables-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-save-table {
            border-radius: 999px;
            padding: 7px 22px;
            font-weight: 700;
            font-size: 0.97rem;
            border: none;
            background: linear-gradient(to right, #22c55e, #16a34a);
            color: #fff;
            box-shadow: 0 8px 20px rgba(34, 197, 94, 0.45);
        }

        .btn-cancel-table {
            border-radius: 999px;
            padding: 7px 18px;
            font-weight: 600;
            font-size: 0.95rem;
            border: 1px solid #cbd5f5;
            background: #f8fafc;
            color: #475569;
        }

        .tables-side-card {
            background: #0f172a;
            border-radius: 20px;
            color: #e5e7eb;
            padding: 18px;
            position: relative;
            overflow: hidden;
        }

            .tables-side-card::before {
                content: "";
                position: absolute;
                inset: -40%;
                background: radial-gradient(circle at 10% 0%, rgba(56, 189, 248, 0.18), transparent 55%), radial-gradient(circle at 90% 100%, rgba(96, 165, 250, 0.3), transparent 55%);
                opacity: 0.9;
                pointer-events: none;
            }

        .tables-side-content {
            position: relative;
            z-index: 1;
        }

        .tables-side-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .tables-side-line {
            font-size: 0.9rem;
            color: #cbd5f5;
        }

        .tables-preview {
            margin-top: 10px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.75);
            padding: 9px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 6px;
        }

        .tables-preview-cell {
            border-radius: 10px;
            background: rgba(30, 64, 175, 0.9);
            padding: 6px 7px;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .tables-preview-name {
            font-weight: 700;
        }

        .tables-preview-meta {
            font-size: 0.72rem;
            color: #bfdbfe;
        }

        .tables-list-card {
            max-width: 1180px;
            margin: 18px auto 0;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.09);
            padding: 14px 18px 12px;
        }

        .tables-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .tables-list-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0f3f8c;
        }

        .tables-list-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

            .tables-list-table th,
            .tables-list-table td {
                padding: 6px 8px;
                border-bottom: 1px solid #e2e8f0;
                text-align: left;
            }

            .tables-list-table th {
                font-size: 0.8rem;
                text-transform: uppercase;
                color: #64748b;
            }

        .tables-pill-active {
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 0.76rem;
            background: #dcfce7;
            color: #15803d;
            font-weight: 600;
        }

        .tables-pill-inactive {
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 0.76rem;
            background: #fee2e2;
            color: #b91c1c;
            font-weight: 600;
        }

        .tables-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.96);
            color: #f9fafb;
            padding: 8px 22px;
            border-radius: 999px;
            font-size: 0.9rem;
            box-shadow: 0 18px 45px rgba(15, 23, 42, .7);
            display: none;
            z-index: 9999;
        }

        @@media (max-width: 960px) {
            .tables-shell

        {
            grid-template-columns: minmax(0, 1fr);
        }

        .tables-list-card {
            margin-inline: 8px;
        }

        }
    </style>
}

<div class="tables-page">
    <div class="tables-shell">

        <!-- LEFT: FORM CARD -->
        <div class="tables-card">
            <div class="tables-card-header">
                <div>
                    <div class="tables-title-main">
                        <i class="fa fa-chair"></i>
                        <span>Add Tables</span>
                    </div>
                    <div class="tables-sub">
                        Link each table with a location / floor for fast order routing.
                    </div>
                </div>
                <span class="tables-badge">
                    Dining Layout
                </span>
            </div>

            <form asp-action="Create" asp-controller="Table" method="post" id="tableForm">
                @Html.AntiForgeryToken()

                <div class="tables-form-grid">
                    <div class="tables-field">
                        <label>Location / Floor *</label>
                        <select asp-for="LocationId" asp-items="Model.LocationList" id="LocationId">
                            <option value="">-- select location --</option>
                        </select>

                        <span asp-validation-for="LocationId" class="text-danger"></span>
                        <small>e.g. Ground Floor, First Floor, Rooftop</small>
                    </div>

                    <div class="tables-field">
                        <label>Table Name *</label>
                        <input asp-for="TableName" id="TableName" placeholder="e.g. T1, Family 1, Corner 3" />
                        <span asp-validation-for="TableName" class="text-danger"></span>
                    </div>

                    <div class="tables-field">
                        <label>Table No / Code</label>
                        <input asp-for="TableCode" id="TableCode" placeholder="e.g. 01, 102, C-3" />
                        <span asp-validation-for="TableCode" class="text-danger"></span>
                    </div>

                    <div class="tables-field">
                        <label>Seating Capacity</label>
                        <input asp-for="Capacity" id="Capacity" type="number" min="1" placeholder="e.g. 4, 6" />
                        <span asp-validation-for="Capacity" class="text-danger"></span>
                    </div>

                    <div class="tables-field">
                        <label>Is Active?</label>
                        <select asp-for="IsActive" id="IsActive">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>

                    <div class="tables-field">
                        <label>Notes</label>
                        <textarea asp-for="Notes" id="Notes" rows="2" placeholder="e.g. Near window, VIP"></textarea>
                    </div>
                </div>

                <div class="tables-actions">
                    <a asp-action="Index" asp-controller="Home" class="btn-cancel-table">
                        Cancel
                    </a>
                    <button type="submit" class="btn-save-table" id="saveBtn">
                        <i class="fa fa-save"></i> Save Table
                    </button>
                </div>
            </form>
        </div>

        <!-- RIGHT: INFO / PREVIEW CARD -->
        <div class="tables-side-card">
            <div class="tables-side-content">
                <div class="tables-side-title">How this will connect to Touch POS?</div>
                <div class="tables-side-line">
                    • You will save tables with locations here.<br />
                    • In Touch POS window, each table shows as a button.<br />
                    • Orders will be linked with Table + Location.
                </div>

                <div class="tables-preview">
                    <div class="tables-preview-cell">
                        <div class="tables-preview-name">T1</div>
                        <div class="tables-preview-meta">Ground • 4 seats</div>
                    </div>
                    <div class="tables-preview-cell">
                        <div class="tables-preview-name">T2</div>
                        <div class="tables-preview-meta">Ground • 2 seats</div>
                    </div>
                    <div class="tables-preview-cell">
                        <div class="tables-preview-name">F1</div>
                        <div class="tables-preview-meta">First • 6 seats</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- NEECHE TABLES LIST -->
    <div class="tables-list-card">
        <div class="tables-list-header">
            <div class="tables-list-title">
                Existing Tables
            </div>
        </div>
        <table class="tables-list-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Location</th>
                    <th>Table</th>
                    <th>Code</th>
                    <th>Seats</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ExistingTables != null && Model.ExistingTables.Any())
                {
                    var i = 1;
                    foreach (var t in Model.ExistingTables)
                    {
                        <tr>
                            <td>@i</td>
                            <td>@t.LocationName</td>
                            <td>@t.TableName</td>
                            <td>@t.TableCode</td>
                            <td>@(t.Capacity ?? 0)</td>
                            <td>
                                @if (t.IsActive)
                                {
                                    <span class="tables-pill-active">Active</span>
                                }
                                else
                                {
                                    <span class="tables-pill-inactive">Inactive</span>
                                }
                            </td>
                        </tr>
                        i++;
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" style="color:#94a3b8;font-size:0.86rem;">
                            No tables yet. Add your first table on the left.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="tables-toast" id="tablesToast">Table saved successfully</div>

@section Scripts {
    <script>
        const loc    = document.getElementById('LocationId');
        const tname  = document.getElementById('TableName');
        const tcode  = document.getElementById('TableCode');
        const cap    = document.getElementById('Capacity');
        const active = document.getElementById('IsActive');
        const notes  = document.getElementById('Notes');
        const form   = document.getElementById('tableForm');

        function focusAndSelect(el) {
            if (!el) return;
            el.focus();
            if (el.select) el.select();
        }

        loc.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); focusAndSelect(tname); }
        });
        tname.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); focusAndSelect(tcode); }
        });
        tcode.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); focusAndSelect(cap); }
        });
        cap.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); focusAndSelect(active); }
        });
        active.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); focusAndSelect(notes); }
        });
        notes.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                form.submit();
            }
        });

        function showTablesToast(msg) {
            const t = document.getElementById('tablesToast');
            if (msg) t.textContent = msg;
            t.style.display = 'block';
            setTimeout(() => {
                t.style.display = 'none';
            }, 1000);
        }

        @if (TempData["Success"] != null)
        {
                <text>
                    window.addEventListener('load', function () {
                        showTablesToast('@TempData["Success"]');
                    });
                </text>
        }
    </script>
}
