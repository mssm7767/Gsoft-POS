@*
    Views/Shared/_Layout.cshtml
*@
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - GSoft POS</title>

    <!-- Bootstrap & Font-Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="~/css/sidebar.css" rel="stylesheet" />

    @RenderSection("Styles", required: false)
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo">
            G-Soft POS
            <button class="sidebar-toggle" id="sidebarToggle" title="Collapse/Expand">
                <span class="toggle-bar"><i class="fa fa-bars"></i></span>
            </button>
        </div>
        <ul class="sidebar-menu">

            <li>
                <a asp-controller="Home" asp-action="Index"
                   class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active" : "")">
                    <i class="fa fa-th-large"></i> <span>Dashboard</span>
                </a>
            </li>

            <!-- Add Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-plus-circle"></i> <span>Add</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="User" asp-action="Create"><i class="fa fa-user-plus"></i> Add New User</a></li>
                    <li><a asp-controller="Customer" asp-action="Create"><i class="fa fa-user"></i> Add Customer</a></li>
                    <li><a asp-controller="Supplier" asp-action="Create"><i class="fa fa-user-tie"></i> Add Supplier</a></li>
                    <li><a asp-controller="Category" asp-action="Create"><i class="fa fa-tags"></i> Add Category</a></li>
                    <li><a asp-controller="SubCategory" asp-action="Create"><i class="fa fa-tag"></i> Add Sub Category</a></li>
                    <li><a asp-controller="Location" asp-action="Create"><i class="fa fa-map-marker-alt"></i> Add Location</a></li>
                </ul>
            </li>

            <!-- Items Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-box"></i> <span>Items</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li>
                        <a asp-controller="Item" asp-action="Add">
                            <i class="fa fa-plus-circle"></i> New Item
                        </a>
                    </li>
                    <li>
                        <a asp-controller="Item" asp-action="Index">
                            <i class="fa fa-edit"></i> Stock List
                        </a>
                    </li>
                    <li>
                        <a href="@Url.Action("Index", "StockAdjustment")">
                            <i class="fa fa-exchange-alt"></i> Stock Adjustment
                        </a>
                    </li>
                    <li>
                        <a asp-controller="Unit" asp-action="Create">
                            <i class="fa fa-balance-scale"></i> Units
                        </a>
                    </li>
                </ul>
            </li>


            <!-- Purchase Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-truck"></i> <span>Purchase</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="Purchase" asp-action="Create"><i class="fa fa-plus-circle"></i> New Purchase</a></li>
                    <li><a asp-controller="Purchase" asp-action="Index"><i class="fa fa-list"></i> Purchase List</a></li>
                </ul>
            </li>

            <!-- Sales Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-shopping-cart"></i> <span>Sales</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="Sales" asp-action="POS"><i class="fa fa-plus-circle"></i> POS New</a></li>
                    <li><a asp-controller="Sales" asp-action="Index"><i class="fa fa-list"></i> Sales List</a></li>
                </ul>
            </li>

            <!-- Barcode Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-barcode"></i> <span>Barcode</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="ItemBarcode" asp-action="Index"><i class="fa fa-print"></i> Item Barcode</a></li>
                    <li><a asp-controller="Barcode" asp-action="Print"><i class="fa fa-print"></i> Print Barcodes</a></li>
                </ul>
            </li>

            <!-- Customers Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-users"></i>
                    <span>Customer</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li>
                        <a asp-controller="Customer" asp-action="Create">
                            <i class="fa fa-user-plus"></i> Add Customer
                        </a>
                    </li>
                    <li>
                        <a asp-controller="Sales" asp-action="CustomerReport">
                            <i class="fa fa-list"></i> Customer Reports
                        </a>
                    </li>
                    <li>
                        <a asp-controller="CustomerPayment" asp-action="Receive" target="_blank">
                            <i class="fa fa-money-bill-wave"></i> C.Pay Receiving
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Supplier Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-user-tie"></i> <span>Supplier</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li>
                        <a asp-controller="Supplier" asp-action="Create">
                            <i class="fa fa-user-plus"></i> Add Supplier
                        </a>
                    </li>
                    <li>
                        <a asp-controller="Supplier" asp-action="Index">
                            <i class="fa fa-list"></i> Supplier List
                        </a>
                    </li>
                    <li>
                        <a asp-controller="SupplierPayment" asp-action="Receive" target="_blank">
                            <i class="fa fa-hand-holding-usd"></i> S.Pay Receiving
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Expense Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-money-bill-wave"></i> <span>Expense</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="Expense" asp-action="Create"><i class="fa fa-plus-circle"></i> Add Expense</a></li>
                    <li><a asp-controller="Expense" asp-action="Index"><i class="fa fa-file-invoice-dollar"></i> Expense List</a></li>
                    <li><a asp-controller="ExpenseCategory" asp-action="Create"><i class="fa fa-plus-square"></i> Add Expense Category</a></li>
                    <li><a asp-controller="ExpenseCategory" asp-action="Index"><i class="fa fa-list-ul"></i> Expense Category List</a></li>
                </ul>
            </li>

            <!-- Users Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-users-cog"></i> <span>Users</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="User" asp-action="Create"><i class="fa fa-user-plus"></i> Add New User</a></li>
                    <li><a asp-controller="User" asp-action="Index"><i class="fa fa-list"></i> User List</a></li>
                    <li><a asp-controller="Role" asp-action="Index"><i class="fa fa-user-shield"></i> User Roles</a></li>
                </ul>
            </li>

            <!-- Reports Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-chart-bar"></i> <span>Reports</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="Reports" asp-action="Sales"><i class="fa fa-chart-line"></i> Sales Report</a></li>
                    <li><a asp-controller="Reports" asp-action="Purchases"><i class="fa fa-shopping-cart"></i> Purchase Reports</a></li>
                    <li><a asp-controller="Reports" asp-action="Inventory"><i class="fa fa-warehouse"></i> Inventory Reports</a></li>
                    <li><a asp-controller="Reports" asp-action="CustomerSummary"><i class="fa fa-user-circle"></i> Customer Summary</a></li>
                </ul>
            </li>

            <!-- Accounts Submenu -->
            <li class="has-sub">
                <a href="#">
                    <i class="fa fa-file-invoice-dollar"></i> <span>Accounts</span>
                    <i class="arrow-icon">
                        <svg class="chevron-svg" width="15" height="15" viewBox="0 0 16 16" fill="none">
                            <path d="M5 7L8 10L11 7"
                                  stroke="currentColor"
                                  stroke-width="1.7"
                                  stroke-linecap="round"
                                  stroke-linejoin="round" />
                        </svg>
                    </i>
                </a>
                <ul class="submenu">
                    <li><a asp-controller="Reports" asp-action="IncomeStatement"><i class="fa fa-balance-scale"></i> Income Statement</a></li>
                    <li><a asp-controller="Expense" asp-action="Index"><i class="fa fa-money-bill-wave"></i> Expense Report</a></li>
                    <li><a asp-controller="Reports" asp-action="TrialBalance"><i class="fa fa-balance-scale"></i> Trial Balance</a></li>
                    <li><a asp-controller="Reports" asp-action="BalanceSheet"><i class="fa fa-balance-scale"></i> Balance Sheet</a></li>
                </ul>
            </li>

            <li>
                <a asp-controller="Sms" asp-action="Index"><i class="fa fa-sms"></i> <span>SMS</span></a>
            </li>
            <li>
                <a asp-controller="Settings" asp-action="Index"><i class="fa fa-cogs"></i> <span>Settings</span></a>
            </li>
        </ul>
        <div class="sidebar-bottom">
            <a class="text-danger" href="/Account/Logout">
                <i class="fa fa-sign-out-alt"></i> <span>Logout</span>
            </a>
            <a class="text-secondary" href="#" onclick="window.close(); return false;">
                <i class="fa fa-power-off"></i> <span>Exit</span>
            </a>
        </div>
    </div>

    <div class="main-content" id="mainContent" style="padding: 20px !important;">
        @RenderBody()
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var sidebar = document.getElementById('sidebar');
            var mainContent = document.getElementById('mainContent');
            var sidebarToggle = document.getElementById('sidebarToggle');
            sidebarToggle.addEventListener('click', function () {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('collapsed');
            });

            document.querySelectorAll(".has-sub > a").forEach(item => {
                item.addEventListener("click", function (e) {
                    e.preventDefault();
                    const parent = this.parentElement;
                    const isOpen = parent.classList.contains("open");
                    Array.from(parent.parentElement.children)
                        .filter(el => el !== parent)
                        .forEach(sib => sib.classList.remove("active", "open"));
                    parent.classList.toggle("active", !isOpen);
                    parent.classList.toggle("open", !isOpen);
                });
            });
            document.querySelectorAll(".submenu.child a").forEach(link => {
                link.addEventListener("click", function (e) {
                    e.stopPropagation();
                });
            });
        });
    </script>

    @RenderSection("Scripts", required: false)

    @section Scripts {
        <script>
            window.addEventListener('DOMContentLoaded', () => {
                const notification = document.getElementById('notification');
                if (notification) {
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        setTimeout(() => notification.style.display = 'none', 500);
                    }, 1500);
                }
            });

             @await RenderSectionAsync("Scripts", required: false)

                         <script>
            document.addEventListener('DOMContentLoaded', function () {
              var table = document.getElementById('customersTable');
              if (!table) return;
              table.setAttribute('tabindex','0');

              function firstVisibleRow() {
                var rows = Array.from(table.querySelectorAll('tbody tr'));
                return rows.find(function(r){ return r.style.display !== 'none'; }) || null;
              }

              function clearSelection() {
                table.querySelectorAll('tbody tr.row-selected').forEach(function(r){
                  r.classList.remove('row-selected');
                });
              }

              function selectRow(r) {
                if (!r || r.style.display === 'none') return;
                clearSelection();
                r.classList.add('row-selected');
                r.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              }

              // Page load: thoda delay dekar focus + first row select
              setTimeout(function () {
                var r = firstVisibleRow();
                if (r && !table.querySelector('tbody tr.row-selected')) {
                  selectRow(r);
                }
                table.focus();
              }, 60);
            });

                        <script>
            document.addEventListener('DOMContentLoaded', function () {
              var toast = document.getElementById('successToast');
              if (!toast) return;

              // 1) chhota chime (optional)
              try {
                var ctx = new (window.AudioContext || window.webkitAudioContext)();
                var now = ctx.currentTime;
                function tone(freq, start, dur){
                  var o = ctx.createOscillator(), g = ctx.createGain();
                  o.type = 'sine'; o.frequency.value = freq;
                  o.connect(g); g.connect(ctx.destination);
                  g.gain.setValueAtTime(0.0001, start);
                  g.gain.exponentialRampToValueAtTime(0.2, start + 0.01);
                  g.gain.exponentialRampToValueAtTime(0.0001, start + dur);
                  o.start(start); o.stop(start + dur + 0.02);
                }
                tone(880,  now + 0.00, 0.12);
                tone(1047, now + 0.12, 0.14);
                setTimeout(function(){ if (ctx && ctx.state !== 'closed') ctx.close(); }, 600);
              } catch(e){}

              // 2) 1.5s baad toast fade + remove, phir list row par scroll + flash
              setTimeout(function () {
                toast.classList.add('fade-out');
                setTimeout(function () {
                  if (toast && toast.parentNode) toast.parentNode.removeChild(toast);

                  // Controller ne bheja hua naam
                  var name = '@(TempData["LastCustomerName"] as string ?? "")'.trim();
                  if (!name) return;

                  // CSS.escape fallback
                  var safeName = (window.CSS && CSS.escape) ? CSS.escape(name) : name.replace(/["\\]/g, "\\$&");

                  // Row locate
                  var row = document.querySelector('tr[data-customer-name="' + safeName + '"]');
                  if (row) {
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    row.classList.add('row-highlight');
                    setTimeout(function(){ row.classList.remove('row-highlight'); }, 2000);
                  }
                }, 600); // fade duration match
              }, 1500); // visible 1.5s
            });
        </script>

        </script>

        
    }

   

</body>
</html>
